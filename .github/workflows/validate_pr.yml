name: PR Format Validation

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Title Format
        uses: actions/github-script@v7
        with:
          script: |
            const prTitle = context.payload.pull_request.title;
            // Preferred format: "directory: description"
            // Also allow: "type: description" (e.g., "feat: Add feature", "fix: Fix bug")
            // Also allow: plain descriptions for cross-cutting changes
            const preferredFormat = /^([\w\s,{}/.]+): .+/;
            const typeFormat = /^(feat|fix|refactor|docs|test|chore|style|perf): .+/i;

            if (!preferredFormat.test(prTitle) && !typeFormat.test(prTitle)) {
              core.warning(`⚠️ PR title "${prTitle}" does not match recommended format.`);
              core.warning('Recommended formats:');
              core.warning('  - "directory: description" (e.g., "cmd/gethrelay: Add Tor support")');
              core.warning('  - "type: description" (e.g., "feat: Add Tor hidden RPC support")');
              core.warning('This is a warning only - PR will not be blocked.');
            } else {
              console.log('✅ PR title format is valid');
            }
